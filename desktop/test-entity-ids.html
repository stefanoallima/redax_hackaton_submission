<!DOCTYPE html>
<html>
<head>
    <title>Entity ID Test</title>
</head>
<body>
    <h1>Entity ID Collision Test</h1>
    <div id="output"></div>

    <script>
        // Simulate the entities from your document
        const entities = [
            { entity_type: 'EMAIL_ADDRESS', text: 'danielagambardella@ordineavvocatiroma.org', start: 449, end: 490 },
            { entity_type: 'EMAIL_ADDRESS', text: 'avv.marcovannini@pec.com', start: 985, end: 1009 },
            { entity_type: 'PERSON', text: 'Ill.mi', start: 124, end: 130 }
        ];

        // Generate IDs like the app does
        const timestamp = Date.now();
        const entitiesWithIds = entities.map((e, idx) => ({
            ...e,
            _id: `${timestamp}-${idx}-${e.start}-${e.end}`
        }));

        // Check for duplicates
        const ids = entitiesWithIds.map(e => e._id);
        const uniqueIds = new Set(ids);

        const output = document.getElementById('output');
        output.innerHTML = `
            <p><strong>Total entities:</strong> ${entities.length}</p>
            <p><strong>Unique IDs:</strong> ${uniqueIds.size}</p>
            <p><strong>Has duplicates:</strong> ${ids.length !== uniqueIds.size ? 'YES ⚠️' : 'NO ✓'}</p>
            <h2>Entity IDs:</h2>
            <ul>
                ${entitiesWithIds.map(e => `
                    <li>
                        <strong>${e.text}</strong><br>
                        ID: <code>${e._id}</code><br>
                        Position: ${e.start}-${e.end}
                    </li>
                `).join('')}
            </ul>
            <h2>Sorted by start position:</h2>
            <ul>
                ${[...entitiesWithIds].sort((a, b) => a.start - b.start).map(e => `
                    <li>
                        <strong>${e.text}</strong> (start: ${e.start})<br>
                        ID: <code>${e._id}</code>
                    </li>
                `).join('')}
            </ul>
        `;
    </script>
</body>
</html>
