INCREMENTAL FILTER TEST RESULTS - ANALYSIS
================================================================================

TEST RESULTS SUMMARY:
--------------------------------------------------------------------------------
Configuration                            F1 Score     Precision    Recall
--------------------------------------------------------------------------------
Baseline (No Filters)                    7.84%        4.44%        33.33%
Test A (Entity Thresholds Only)          4.55%        2.86%        11.11%
Test B (Prefilter Only)                  7.84%        4.44%        33.33%
Test C (Italian Context Only)            7.84%        4.44%        33.33%
Full Pipeline (All Filters)              4.55%        2.86%        11.11%

FILTER IMPACT ANALYSIS (compared to baseline F1=7.84%):
================================================================================

1. Entity Thresholds: -42% F1 SCORE (CRITICAL ISSUE)
   - Drops F1 from 7.84% to 4.55%
   - Reduces true positives from 6 to 2 (loses 4 legitimate PII entities!)
   - Increases false negatives from 12 to 16
   - This filter is SEVERELY HARMFUL and should be disabled

2. Prefilter: 0% impact (NO EFFECT)
   - F1 remains at 7.84%
   - Same precision, recall, and entity counts as baseline
   - This filter appears to have no effect on the current test document

3. Italian Context Filter: 0% impact (NO EFFECT)
   - F1 remains at 7.84%
   - Same precision, recall, and entity counts as baseline
   - This filter appears to have no effect on the current test document

4. Full Pipeline: -42% F1 SCORE
   - Same as Entity Thresholds only (4.55%)
   - Since Prefilter and Italian Context have no effect, the entire degradation
     is attributable to Entity Thresholds

ROOT CAUSE IDENTIFIED:
================================================================================

The Entity Thresholds filter is the sole cause of performance degradation.

Problem: The entity-specific confidence thresholds are TOO RESTRICTIVE
- They filter out 4 out of 6 true positive detections
- This increases false negatives by 33% (from 12 to 16)
- Overall recall drops from 33.33% to 11.11%

Detailed Impact:
- Baseline: 135 entities detected, 6 TP, 12 FN, 129 FP
- With Entity Thresholds: 70 entities detected, 2 TP, 16 FN, 68 FP
- Lost: 4 true positive PII entities that should have been detected

RECOMMENDATIONS:
================================================================================

IMMEDIATE ACTION (Priority 0):
1. DISABLE entity_thresholds in production configuration
   - Current configuration causes 67% of detected PII to be incorrectly filtered
   - This is a critical privacy risk (missing PII entities in redaction)

MEDIUM-TERM FIXES (Priority 1):
2. Review and recalibrate entity threshold values in entity_thresholds.py
   - Current thresholds are clearly too high for Italian legal documents
   - Consider lowering thresholds by 0.1-0.2 for all entity types
   - Test with "thorough" depth mode (thresholds: 0.65 instead of 0.75)

3. Investigate why Prefilter and Italian Context filters have no effect
   - Expected these to reduce false positives (129 is very high)
   - May need to review filter implementation or test with different documents

OPTIMAL CONFIGURATION (based on current test results):
================================================================================

IntegratedPIIDetector(
    enable_gliner=True,
    use_multi_model=True,
    enable_prefilter=True,           # No harm, may help with other documents
    enable_italian_context=True,     # No harm, may help with other documents
    enable_entity_thresholds=False   # DISABLED - causes 42% F1 degradation
)

Expected Performance:
- F1 Score: 7.84%
- Precision: 4.44%
- Recall: 33.33%
- True Positives: 6 out of 18 expected PII entities

Note: Overall F1 is still low (7.84% vs target 60-80%) due to:
- High false positive rate (129 FP vs 6 TP)
- Low recall (only 6 out of 18 PII entities detected)
- These issues require deeper investigation of GLiNER model configuration
  and entity mapping (separate from filter configuration)
